{% extends 'base.html' %} {% block content %}

<div class="chat-container">
  <div class="header">
    <h2>Chat Room: {{ code }}</h2>
    <button id="dark-mode-toggle">ðŸŒ™</button>
  </div>
  
  <div class="users-list">
    <h3>Users Online:</h3>
    <ul id="user-list">
      {% for user in users %}
      <li><img src="https://api.dicebear.com/7.x/identicon/svg?seed={{ user }}" class="avatar"> {{ user }}</li>
      {% endfor %}
    </ul>
  </div>

  <div class="messages" id="messages"></div>
  
  <div class="inputs">
    <input type="text" rows="3" placeholder="Message" name="message" id="message" oninput="sendTyping()" />
    <button type="button" name="send" id="send-btn" onClick="sendMessage()">Send</button>
  </div>
  <p id="typing-indicator"></p>
</div>

<script type="text/javascript">
  var socketio = io();
  const messages = document.getElementById("messages");
  const typingIndicator = document.getElementById("typing-indicator");
  const userList = document.getElementById("user-list");

  function createMessage(name, msg, timestamp) {
    const content = `
    <div class="message-box">
      <img src="https://api.dicebear.com/7.x/identicon/svg?seed=${name}" class="avatar">
      <div class="text-bubble">
        <strong>${name}</strong>: ${msg}
        <span class="timestamp">${timestamp}</span>
      </div>
    </div>`;
    messages.innerHTML += content;
    messages.scrollTop = messages.scrollHeight;
  }

  function sendTyping() {
    socketio.emit("typing", { typing: true });
  }

  socketio.on("typing", (data) => {
    typingIndicator.innerText = data.typing ? `${data.name} is typing...` : "";
  });

  socketio.on("message", (data) => {
    createMessage(data.name, data.message, data.timestamp);
  });

  function sendMessage() {
    const message = document.getElementById("message");
    if (message.value == "") return;
    socketio.emit("message", { data: message.value });
    message.value = "";
  }

  document.getElementById("dark-mode-toggle").addEventListener("click", function () {
    document.body.classList.toggle("dark-mode");
  });
</script>

{% endblock %}
